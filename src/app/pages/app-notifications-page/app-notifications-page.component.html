<app-header-title 
  title="Notifications" 
  subtitle="Manage your notifications and stay updated with the latest activities">
</app-header-title>

<div class="notifications-container">
  <!-- Filters Section -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>filter_list</mat-icon>
        Filter Notifications
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <div class="filters-grid">
        <!-- Search -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search notifications...</mat-label>
          <mat-icon matPrefix>search</mat-icon>
          <input 
            matInput 
            [value]="searchQuery"
            (input)="onSearchInput($event)"
            placeholder="Search by title, message, or user">
          <button 
            *ngIf="searchQuery" 
            matSuffix 
            mat-icon-button 
            (click)="onSearchChange('')">
            <mat-icon>clear</mat-icon>
          </button>
        </mat-form-field>

        <!-- Type Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Notification Types</mat-label>
          <mat-select 
            multiple 
            [value]="selectedTypes" 
            (selectionChange)="onTypeFilterChange($event.value)">
            <mat-option 
              *ngFor="let type of Object.values(NotificationType)" 
              [value]="type">
              <mat-icon [style.color]="getNotificationColor({type: type, priority: NotificationPriority.MEDIUM})">
                {{ getTypeIcon(type) }}
              </mat-icon>
              {{ getTypeLabel(type) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Priority Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Priority</mat-label>
          <mat-select 
            multiple 
            [value]="selectedPriorities" 
            (selectionChange)="onPriorityFilterChange($event.value)">
            <mat-option 
              *ngFor="let priority of Object.values(NotificationPriority)" 
              [value]="priority">
              <mat-icon [style.color]="getPriorityColor(priority)">
                {{ getPriorityIcon(priority) }}
              </mat-icon>
              {{ getPriorityLabel(priority) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Status Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select 
            multiple 
            [value]="selectedStatuses" 
            (selectionChange)="onStatusFilterChange($event.value)">
            <mat-option value="unread">
              <mat-icon style="color: #6c4bb6;">fiber_manual_record</mat-icon>
              Unread
            </mat-option>
            <mat-option value="read">
              <mat-icon style="color: #4caf50;">check_circle</mat-icon>
              Read
            </mat-option>
            <mat-option value="archived">
              <mat-icon style="color: #666;">archive</mat-icon>
              Archived
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Filter Actions -->
      <div class="filter-actions">
        <button 
          mat-button 
          (click)="clearFilters()"
          [disabled]="!searchQuery && selectedTypes.length === 0 && selectedPriorities.length === 0 && selectedStatuses.length === 0">
          <mat-icon>clear_all</mat-icon>
          Clear Filters
        </button>
        
        <div class="spacer"></div>
        
        <button 
          mat-raised-button 
          color="primary" 
          (click)="markAllAsRead()"
          [disabled]="loading">
          <mat-icon>done_all</mat-icon>
          Mark All Read
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Results Summary -->
  <div class="results-summary" *ngIf="!loading">
    <p>
      Showing {{ paginatedNotifications.length }} of {{ totalCount }} notifications
      <span *ngIf="totalCount !== notifications.length">
        ({{ notifications.length }} total)
      </span>
    </p>
  </div>

  <!-- Notifications List -->
  <div class="notifications-list">
    <!-- Loading State -->
    <mat-card *ngIf="loading" class="loading-card">
      <mat-card-content>
        <div class="loading-content">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading notifications...</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- No Results -->
    <mat-card *ngIf="!loading && paginatedNotifications.length === 0" class="no-results-card">
      <mat-card-content>
        <div class="no-results-content">
          <mat-icon>notifications_none</mat-icon>
          <h3>No notifications found</h3>
          <p *ngIf="searchQuery || selectedTypes.length > 0 || selectedPriorities.length > 0 || selectedStatuses.length > 0">
            Try adjusting your filters to see more results.
          </p>
          <p *ngIf="!searchQuery && selectedTypes.length === 0 && selectedPriorities.length === 0 && selectedStatuses.length === 0">
            You don't have any notifications yet.
          </p>
          <button mat-button (click)="clearFilters()" *ngIf="searchQuery || selectedTypes.length > 0 || selectedPriorities.length > 0 || selectedStatuses.length > 0">
            <mat-icon>refresh</mat-icon>
            Clear Filters
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Notification Items -->
    <mat-card 
      *ngFor="let notification of paginatedNotifications; trackBy: trackByNotificationId"
      class="notification-card"
      [class.unread]="notification.status === NotificationStatus.UNREAD"
      [class.high-priority]="notification.priority === NotificationPriority.HIGH || notification.priority === NotificationPriority.URGENT"
      (click)="onNotificationClick(notification)">
      
      <mat-card-content>
        <div class="notification-content">
          <!-- Icon -->
          <div class="notification-icon">
            <mat-icon [style.color]="getNotificationColor(notification)">
              {{ getNotificationIcon(notification) }}
            </mat-icon>
          </div>

          <!-- Main Content -->
          <div class="notification-main">
            <div class="notification-header">
              <h3 class="notification-title">{{ notification.title }}</h3>
              <div class="notification-meta">
                <span class="notification-time">{{ formatTimestamp(notification.timestamp) }}</span>
                <mat-chip 
                  class="priority-chip"
                  [style.background-color]="getPriorityColor(notification.priority)"
                  [style.color]="'white'"
                  *ngIf="notification.priority === NotificationPriority.HIGH || notification.priority === NotificationPriority.URGENT">
                  <mat-icon matChipAvatar>{{ getPriorityIcon(notification.priority) }}</mat-icon>
                  {{ getPriorityLabel(notification.priority) }}
                </mat-chip>
              </div>
            </div>

            <p class="notification-message">{{ notification.message }}</p>

            <div class="notification-footer" *ngIf="notification.userName || notification.actionLabel">
              <div class="notification-user" *ngIf="notification.userName">
                <mat-icon class="user-icon">person</mat-icon>
                <span>{{ notification.userName }}</span>
              </div>
              <div class="notification-action" *ngIf="notification.actionLabel">
                <mat-icon>open_in_new</mat-icon>
                <span>{{ notification.actionLabel }}</span>
              </div>
            </div>

            <!-- Type and Status Indicators -->
            <div class="notification-indicators">
              <mat-chip class="type-chip">
                <mat-icon matChipAvatar>{{ getTypeIcon(notification.type) }}</mat-icon>
                {{ getTypeLabel(notification.type) }}
              </mat-chip>
              
              <mat-chip 
                class="status-chip"
                [class.status-unread]="notification.status === NotificationStatus.UNREAD"
                [class.status-read]="notification.status === NotificationStatus.READ"
                [class.status-archived]="notification.status === NotificationStatus.ARCHIVED">
                <mat-icon matChipAvatar *ngIf="notification.status === NotificationStatus.UNREAD">fiber_manual_record</mat-icon>
                <mat-icon matChipAvatar *ngIf="notification.status === NotificationStatus.READ">check_circle</mat-icon>
                <mat-icon matChipAvatar *ngIf="notification.status === NotificationStatus.ARCHIVED">archive</mat-icon>
                {{ notification.status | titlecase }}
              </mat-chip>
            </div>
          </div>

          <!-- Actions -->
          <div class="notification-actions">
            <button 
              *ngIf="notification.status === NotificationStatus.UNREAD"
              mat-icon-button 
              matTooltip="Mark as read"
              (click)="markAsRead(notification, $event)"
              class="action-button read-button">
              <mat-icon>done</mat-icon>
            </button>
            
            <button 
              *ngIf="notification.status !== NotificationStatus.ARCHIVED"
              mat-icon-button 
              matTooltip="Archive notification"
              (click)="archiveNotification(notification, $event)"
              class="action-button archive-button">
              <mat-icon>archive</mat-icon>
            </button>
            
            <button 
              mat-icon-button 
              matTooltip="Delete notification"
              (click)="deleteNotification(notification, $event)"
              class="action-button delete-button">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Pagination -->
  <mat-paginator
    *ngIf="!loading && totalCount > 0"
    [length]="totalCount"
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [pageSizeOptions]="pageSizeOptions"
    [showFirstLastButtons]="true"
    (page)="onPageChange($event)"
    class="notifications-paginator">
  </mat-paginator>
</div>